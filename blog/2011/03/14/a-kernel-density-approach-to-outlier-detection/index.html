
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Kernel Density Approach to Outlier Detection - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="I describe a kernel density approach to outlier detection on small datasets. In particular, my model is the set of prices for a given item that can &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://echen.github.com/blog/2011/03/14/a-kernel-density-approach-to-outlier-detection">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:echen.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Kernel Density Approach to Outlier Detection</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-14T04:25:09-07:00" pubdate data-updated="true">Mar 14<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I describe a kernel density approach to outlier detection on small datasets. In particular, my model is the set of prices for a given item that can be found online.</p>

<h1>Introduction</h1>

<p>Suppose you&#8217;re searching online for the cheapest place to buy a stats book you need for class.</p>

<p>You initially find the following prices:</p>

<pre><code>$50 - Amazon
$55 - Barnes &amp; Noble
$52 - Walmart
$50 - Borders
</code></pre>

<p>You&#8217;re about to buy it from Amazon when you whimsically decide to try searching again. This time you find an eBay listing for the book at the low price of $30.</p>

<p>Should you buy it from eBay? Or is the listing just a scam? What if, instead, the price distribution of the other sellers were more widely dispersed?</p>

<pre><code>$50 - Amazon
$75 - Barnes &amp; Noble
$60 - Walmart
$90 - Borders
</code></pre>

<p>In other words, given the price distribution of the other sellers, you&#8217;d like to know how likely it is that a price of $30 is legitimate.</p>

<p>I describe a solution to this problem based on kernel density estimation.</p>

<h1>Other Approaches</h1>

<p>Let&#8217;s consider some other approaches first. Suppose we have a set of prices $latex {x _ {min}} cup {x _ 1, ldots, x _ n}$, where $latex x _ {min}$ is strictly less than all the other prices in $latex X = {x _ 1, ldots, x _ n}$.</p>

<h2>A Normal Approach</h2>

<p>One simple approach to determining how cautious we should be of the price $latex x _ {min}$ is to calculate the mean $latex mu _ X$ and standard deviation $latex sigma _ X$ of $latex X$, and flag $latex x _ {min}$ if it falls some number of standard deviations below the mean.</p>

<p>However, this approach is flawed for several reasons. First, what if the prices in $latex X$ are all equal, say $latex X = {$50, $50, $50}$, so that $latex sigma_x = 0$? Then any $latex x_{min} &lt; 50$ will be flagged, even $latex x _ {min} = $49$, which we don&#8217;t want.</p>

<p>A simple heuristic (say, flag $latex x _ {min}$ only if it also falls at least $latex 10%$ below $latex mu _ X$) can fix this problem, though, so a more glaring problem is that the approach assumes prices follow a normal distribution, which they often do not. For example, bimodal distributions such as the following</p>

<pre><code>$20 - Amazon
$25 - Barnes &amp; Noble
$22 - Walmart
$21 - Borders

$45 - eBay
$40 - Books Inc.
$43 - Waldenbooks
</code></pre>

<p>often arise, in which sellers seem to fall into two sets, one with higher prices and one with lower. (For example, perhaps a paperback version of a book was just released, and the megastore booksellers have slashed the price of the hardback version accordingly, while the small-scale booksellers have yet to react.)</p>

<p>In general, it is unclear what distribution prices fall into (they do not have a lognormal distribution either), so it seems that we must look at non-parametric approaches instead.</p>

<h2>An IQR Approach</h2>

<p>One non-parametric method (which we all learn in grade school) is the interquartile method, in which we calculate the interquartile range of $latex X$ (the difference between the price falling in the $latex 75$th percentile of $latex X$ and the price falling in the $latex 25$th percentile of $latex X$) and view $latex x _ {min}$ with caution if it falls below $latex mu _ X - cIQR(X)$ for some positive constant $latex c$.</p>

<p>Again, though, this method fails. For example, in the bimodal distribution above, the 75th percentile of the prices is 41.50 and the 25th percentile is 21.5, giving a rather large interquartile range of 20.00. Even with a conservative choice of $latex c = 1.5$, we flag outliers only if they fall below $latex mu _ X - 1.5($20) = $latex 30.86 - 1.5($20) = $latex 0.86$, which doesn&#8217;t seem correct.</p>

<p>We need, then, a non-parametric approach which also takes into account the dispersion and clusters of prices.</p>

<h1>A Kernel Density Approach</h1>

<p>Recall that the kernel density estimate of a price $latex x$ given prices $latex X = {x _ 1, ldots, x _ n}$ is</p>

<p>$latex KDE(x) = frac{1}{n} sum _ {i = 1} ^ n Kleft(frac{x - x _ i}{h}right),$</p>

<p>where $latex K$ is some kernel function and $latex h$ is a bandwidth parameter.</p>

<p>In my tests, I used a Gaussian kernel with bandwidth $latex 0.1x _ i$,</p>

<p>$latex Kleft(frac{x - x _ i}{0.1x _ i}right) = frac{1}{sqrt{2pi}} e ^ {frac{-(x - x _ i) ^ 2}{2(0.1x _ i) ^ 2}}.$</p>

<p>For example, given a set of original prices $latex {50, 55, 52, 50, 90, 95, 93}$</p>

<p><a href="http://dl.dropbox.com/u/10506/blog/kde-outlier-detection/original%20prices.png"><img src="http://dl.dropbox.com/u/10506/blog/kde-outlier-detection/original%20prices.png" alt="Original Prices" /></a></p>

<p>here are the kernel density estimates of a new set of prices:</p>

<p><a href="http://dl.dropbox.com/u/10506/blog/kde-outlier-detection/kernel%20density%20estimates.png"><img src="http://dl.dropbox.com/u/10506/blog/kde-outlier-detection/kernel%20density%20estimates.png" alt="Kernel Density Estimate of New Prices" /></a></p>

<p>Notice the two humps around 50 and 90, which match the two clusters in our original set of prices.</p>

<p>Finally, to take care of cases where all prices were widely dispersed, I compared the kernel density estimate of $latex x _ {min}$ to the average kernel density estimate over all prices in $latex X$:</p>

<p>$latex OutlierScore(x _ {min}) = frac{KDE(x _ {min})}{frac{1}{n}sum _ {x _ i in X} KDE(x _ i) },$</p>

<p>and flagged $latex x _ {min}$ if its outlier score fell below some threshold.</p>

<h2>Adding Sophistication with Local Comparisons</h2>

<p>While the attempt above accounts for price dispersion in our outlier score by dividing against the average kernel density estimate of all prices, a better approach (e.g., in the case of bimodal distributions) would be to take the average only over points $latex N(x _ {min})$ near $latex x _ {min}$:
$latex OutlierScore(x _ {min}) = frac{KDE(x _ {min})}{frac{1}{|N(x _ {min})|}sum _ {x _ i in N(x _ {min})} KDE(x _ i) }.$</p>

<p>For example, I experimented both with taking the $latex m$ nearest neighbors of $latex x _ {min}$, and with performing a $latex k$-means clustering on the prices and taking the points in the same cluster as $latex x _ {min}$, where I estimated $latex k$ using the gap statistic and prediction strength tests.</p>

<p>Although this method didn&#8217;t produce significantly better results than the method that ignored clusters in prices, perhaps due to the relative rarity of distinct price groups in small datasets, the method should be more robust as the number of online retailers and prices per item grows.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2011-03-14T04:25:09-07:00" pubdate data-updated="true">Mar 14<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/expository/'>expository</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://echen.github.com/blog/2011/03/14/a-kernel-density-approach-to-outlier-detection/" data-via="" data-counturl="http://echen.github.com/blog/2011/03/14/a-kernel-density-approach-to-outlier-detection/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/03/14/laymans-introduction-to-measure-theory/" title="Previous Post: Layman's Introduction to Measure Theory">&laquo; Layman's Introduction to Measure Theory</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/03/14/laymans-introduction-to-random-forests/" title="next Post: Layman's Introduction to Random Forests">Layman's Introduction to Random Forests &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/17/quick-introduction-to-ggplot2/">Quick Introduction to ggplot2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/03/introduction-to-conditional-random-fields/">Introduction to Conditional Random Fields</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/24/winning-the-netflix-prize-a-summary/">Winning the Netflix Prize: A Summary</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/29/stuff-harvard-people-like/">Stuff Harvard People Like</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/07/information-transmission-in-a-social-network-dissecting-the-spread-of-a-quora-post/">Information Transmission in a Social Network: Dissecting the Spread of a Quora Post</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
